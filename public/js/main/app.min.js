(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){


class Todo {

    all(page) {

        let request = $.ajax({ url: 'todo?page=' + page, dataType: 'json' });
        let self = this;
        request.done(function (res) {
            self.renderTodo(res);
        }).fail(function () {
            alert('Posts could not be loaded.');
        });
    }

    update(id) {
        let form = $(`#task_form_${ id }`);
        let request = $.ajax({ url: 'todo/' + id, type: 'patch', data: form.serialize() });

        request.done(function (res) {
            $(`#task_span_${ id }`).html(res.task);
            $('#view_' + id).show();
            $('#edit_' + id).hide();
        });
    }

    editCancel(id) {
        let text = $('#task_span_' + id).html();
        $(`#task_input_${ id }`).val(text.trim());
        $('#edit_' + id).hide();
        $('#view_' + id).show();
    }

    edit(id) {
        let text = $('#task_span_' + id).html();
        $('#view_' + id).hide();
        $('#edit_' + id).show();
        $(`#task_input_${ id }`).val(text.trim()).select();
    }

    createCancel() {
        $('.task-create-cancel').hide();
        $('#task_0').remove();
        $('.task-create').show();
    }

    create() {
        $('.task-create-cancel').show();

        let token = $('#_token').val();

        let li = `<li id="task_0" class="collection-item">                    
                    <div id="edit_0" class="edit-mode">
                        <form id="task_form_0" class="col s10">
                            <input type="hidden" name="_token" value="${ token }">
                            <div class="row">
                                <div class="input-field col s10">
                                    <input placeholder="Enter task name" id="task_input_0"
                                           type="text" class="validate" name="task" 
                                            data-task-id="0">
                                </div>
                                <div class="col s2">
                                    <a href="javascript:void(0)" class="secondary-content task-store"
                                       data-task-id="0">
                                        <i class="medium material-icons">done</i>
                                    </a>
                                </div>
                            </div>

                        </form>
                        
                    </div>
                </li>`;

        $('#todo-list').append(li);
        $('#task_0').find('#task_input_0').focus();
    }

    store() {
        let form_data = $('#task_form_0').serialize();
        let url = this.getActivePage() ? `todo?page=${ this.getActivePage() }` : 'todo';
        let request = $.ajax({ url: url, type: 'post', data: form_data });
        let self = this;
        request.done(function (res) {
            self.renderTodo(res);
            $('.task-create-cancel').hide();
            $('.task-create').show();
        });
    }

    getActivePage() {
        let container = $('.pagination');
        let active = container.find('li.active');
        return container.length && active.length ? active.find('span').html().trim() : null;
    }

    deleteDialog(id) {
        let modal = $('#modal-task-delete');
        let task = $(`#task_span_${ id }`);

        $(`#task_${ id }`).addClass('red accent-1');

        modal.data('target-id', id);
        modal.find('#task-to-delete-text').html(task.html().trim());
        modal.openModal();
    }

    deleteCancel() {
        let modal = $('#modal-task-delete');
        let id = modal.data('target-id');
        $(`#task_${ id }`).removeClass('red accent-1');
        modal.closeModal();
    }

    delete() {
        let modal = $('#modal-task-delete');
        let id = modal.data('target-id');
        let url = this.getActivePage() ? `todo/${ id }?page=${ this.getActivePage() }` : `todo/${ id }`;
        let request = $.ajax({ url: url, type: 'delete', data: { _token: $('#_token').val() } });
        let self = this;

        request.done(function (res) {
            modal.closeModal();
            self.renderTodo(res);
        });
    }

    renderTodo(res) {
        let list = $('#todo-list');
        let collection = list.find('li:eq(0)').prop('outerHTML');
        list.empty();

        if (res.data.length) {
            for (let i in res.data) {
                collection += this.li(res.data[i]);
            }

            list.append(collection);
            this.renderPagination(res);
        } else {
            list.append(collection);
            list.append(`<li class="collection-item grey lighten-4 grey-text">
                        [ Add Your first Task ]
                        </li>`);
        }
    }

    renderPagination(res) {
        let pagination = '';

        if (!$('.pagination').length && res.data.length) {
            console.log('create pagination ul');
            $('#pagination-container').append(`<ul class="pagination"></ul>`);
        }

        let container = $('.pagination');

        if (res.data.length) {

            container.empty();

            if (res.last_page > 1) {

                let url = location.protocol + "//" + location.host;

                let prev = res.prev_page_url === null ? `<li><span> << </span></li>` : `<li><a href="${ res.prev_page_url }"> << </a></li>`;

                let next = res.next_page_url === null ? `<li><span> >> </span></li>` : `<li><a href="${ res.next_page_url }"> >> </a></li>`;

                pagination += prev;

                for (let i = 1; i <= res.last_page; i++) {

                    let li = `<li><a href="${ url }?page=${ i }">${ i }</a></li>`;

                    if (res.current_page == i) {
                        li = `<li class="active"><span class="active">${ i }</span></li>`;
                    }

                    pagination += li;
                }

                pagination += next;
                container.append(pagination);
            }
        }
    }

    li(res) {
        let token = $('#_token').val();

        return `<li id="task_${ res.id }" class="collection-item">
                    <div id="view_${ res.id }" class="view-mode">
                        <span id="task_span_${ res.id }">${ res.task }</span>
                        
                        <a href="javascript:void(0)" class="secondary-content task-delete-dialog
                            red-text text-accent-2"
                           data-task-id="${ res.id }" title="Delete Task">
                            <i class="material-icons">delete</i>
                        </a>
                        
                        <a href="javascript:void(0)" class="secondary-content task-edit"
                           data-task-id="${ res.id }">
                            <i class="material-icons">mode_edit</i>
                        </a>
                    </div>
                    
                    <div id="edit_${ res.id }" class="edit-mode" style="display: none">
                        <form id="task_form_${ res.id }" class="col s10">
                            <input type="hidden" name="_token" value="${ token }">
                            <div class="row">
                                <div class="input-field col s10">
                                    <input placeholder="Enter task name" id="task_input_${ res.id }"
                                           type="text" class="validate" name="task" 
                                           data-task-id="${ res.id }">
                                </div>
                                <div class="col s2">
                                <a href="javascript:void(0)" class="secondary-content 
                                        task-edit-cancel red-text text-accent-2" 
                                         data-task-id="${ res.id }">
                                        <i class="material-icons font-35">not_interested</i>
                                    </a>
                                    
                                    <a href="javascript:void(0)" class="secondary-content 
                                     task-update" data-task-id="${ res.id }">
                                        <i class="material-icons font-35">done</i>
                                    </a>
                                </div>
                            </div>

                        </form>

                    </div>
                </li>`;
    }

}

module.exports = new Todo();

},{}],2:[function(require,module,exports){
//$(".button-collapse").sideNav();

var Todo = require('../components/Todo');

$(document).on('click', '.task-create', function (e) {
    e.preventDefault();
    console.log('create');
    $('.task-create').hide();
    Todo.create();
});

$(document).on('click', '.task-create-cancel', function (e) {
    e.preventDefault();
    console.log('task-create-cancel');
    Todo.createCancel();
});

$(document).on('click', '.task-store', function (e) {
    e.preventDefault();
    console.log('create');
    Todo.store();
});

$(document).on("keypress", "input", function (e) {

    if (e.keyCode == 13) {
        e.preventDefault();
        let id = $(this).data('task-id');

        if ($('#task_0').length) {
            Todo.store();
        } else {
            Todo.update(id);
        }

        return false;
    } else if (e.keyCode == 27) {
        let id = $(this).data('task-id');
        if (id == 0) {
            Todo.createCancel();
        } else {
            Todo.editCancel(id);
        }
    }
});

$(document).on('click', '.task-edit', function (e) {
    e.preventDefault();
    console.log('edit');
    let id = $(this).data('task-id');
    Todo.edit(id);
});

$(document).on('click', '.task-edit-cancel', function (e) {
    e.preventDefault();
    console.log('edit-cancel');
    let id = $(this).data('task-id');
    Todo.editCancel(id);
});

$(document).on('click', '.task-update', function (e) {
    e.preventDefault();
    console.log('update');
    let id = $(this).data('task-id');
    Todo.update(id);
});

$(document).on('click', '.task-delete-dialog', function (e) {
    e.preventDefault();
    console.log('delete-dialog');
    let id = $(this).data('task-id');
    Todo.deleteDialog(id);
});

$(document).on('click', '.task-delete-cancel', function (e) {
    e.preventDefault();
    Todo.deleteCancel();
});

$(document).on('click', '.task-delete', function (e) {
    e.preventDefault();
    console.log('delete');
    Todo.delete();
});

$('main').on('click', '.pagination a', function (e) {
    $('.pagination').find('li').removeClass('active disabled');
    $(this).parent().addClass('active');
    Todo.all($(this).attr('href').split('page=')[1]);
    e.preventDefault();
});

$(document).ready(function () {
    $('.task-delete-dialog').leanModal({ dismissible: false });
    Todo.all(1);
});

},{"../components/Todo":1}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJyZXNvdXJjZXNcXGFzc2V0c1xcanNcXGNvbXBvbmVudHNcXFRvZG8uanMiLCJyZXNvdXJjZXNcXGFzc2V0c1xcanNcXG1haW5cXGluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNFQSxNQUFNLElBQU4sQ0FBVzs7QUFFUCxRQUFLLElBQUwsRUFBVzs7QUFFUCxZQUFJLFVBQVUsRUFBRSxJQUFGLENBQU8sRUFBQyxLQUFNLGVBQWUsSUFBdEIsRUFBNEIsVUFBVSxNQUF0QyxFQUFQLENBQWQ7QUFDQSxZQUFJLE9BQU8sSUFBWDtBQUNBLGdCQUFRLElBQVIsQ0FBYSxVQUFVLEdBQVYsRUFBZTtBQUN4QixpQkFBSyxVQUFMLENBQWdCLEdBQWhCO0FBQ0gsU0FGRCxFQUVHLElBRkgsQ0FFUSxZQUFZO0FBQ2hCLGtCQUFNLDRCQUFOO0FBQ0gsU0FKRDtBQUtIOztBQUVELFdBQU8sRUFBUCxFQUFXO0FBQ1AsWUFBSSxPQUFPLEVBQUcsZUFBYSxFQUFHLEdBQW5CLENBQVg7QUFDQSxZQUFJLFVBQVUsRUFBRSxJQUFGLENBQU8sRUFBQyxLQUFLLFVBQVUsRUFBaEIsRUFBb0IsTUFBTSxPQUExQixFQUFtQyxNQUFNLEtBQUssU0FBTCxFQUF6QyxFQUFQLENBQWQ7O0FBRUEsZ0JBQVEsSUFBUixDQUFhLFVBQVMsR0FBVCxFQUFhO0FBQ3RCLGNBQUcsZUFBYSxFQUFHLEdBQW5CLEVBQXNCLElBQXRCLENBQTJCLElBQUksSUFBL0I7QUFDQSxjQUFFLFdBQVcsRUFBYixFQUFpQixJQUFqQjtBQUNBLGNBQUUsV0FBVyxFQUFiLEVBQWlCLElBQWpCO0FBQ0gsU0FKRDtBQUtIOztBQUVELGVBQVcsRUFBWCxFQUFlO0FBQ1gsWUFBSSxPQUFPLEVBQUUsZ0JBQWdCLEVBQWxCLEVBQXNCLElBQXRCLEVBQVg7QUFDQSxVQUFHLGdCQUFjLEVBQUcsR0FBcEIsRUFBdUIsR0FBdkIsQ0FBMkIsS0FBSyxJQUFMLEVBQTNCO0FBQ0EsVUFBRSxXQUFXLEVBQWIsRUFBaUIsSUFBakI7QUFDQSxVQUFFLFdBQVcsRUFBYixFQUFpQixJQUFqQjtBQUNIOztBQUVELFNBQUssRUFBTCxFQUFTO0FBQ0wsWUFBSSxPQUFPLEVBQUUsZ0JBQWdCLEVBQWxCLEVBQXNCLElBQXRCLEVBQVg7QUFDQSxVQUFFLFdBQVcsRUFBYixFQUFpQixJQUFqQjtBQUNBLFVBQUUsV0FBVyxFQUFiLEVBQWlCLElBQWpCO0FBQ0EsVUFBRyxnQkFBYyxFQUFHLEdBQXBCLEVBQXVCLEdBQXZCLENBQTJCLEtBQUssSUFBTCxFQUEzQixFQUF3QyxNQUF4QztBQUNIOztBQUVELG1CQUFlO0FBQ1gsVUFBRSxxQkFBRixFQUF5QixJQUF6QjtBQUNBLFVBQUUsU0FBRixFQUFhLE1BQWI7QUFDQSxVQUFFLGNBQUYsRUFBa0IsSUFBbEI7QUFDSDs7QUFFRCxhQUFTO0FBQ0wsVUFBRSxxQkFBRixFQUF5QixJQUF6Qjs7QUFFQSxZQUFJLFFBQVEsRUFBRSxTQUFGLEVBQWEsR0FBYixFQUFaOztBQUVBLFlBQUksS0FBTTs7O3dFQUFBLENBR3NELEtBQU07Ozs7Ozs7Ozs7Ozs7Ozs7OztzQkFIdEU7O0FBd0JBLFVBQUUsWUFBRixFQUFnQixNQUFoQixDQUF1QixFQUF2QjtBQUNBLFVBQUUsU0FBRixFQUFhLElBQWIsQ0FBa0IsZUFBbEIsRUFBbUMsS0FBbkM7QUFFSDs7QUFFRCxZQUFRO0FBQ0osWUFBSSxZQUFZLEVBQUUsY0FBRixFQUFrQixTQUFsQixFQUFoQjtBQUNBLFlBQUksTUFBTyxLQUFLLGFBQUwsRUFBRCxHQUEwQixjQUFZLEtBQUssYUFBTCxFQUFxQixHQUEzRCxHQUErRCxNQUF6RTtBQUNBLFlBQUksVUFBVSxFQUFFLElBQUYsQ0FBTyxFQUFDLEtBQUssR0FBTixFQUFXLE1BQU0sTUFBakIsRUFBeUIsTUFBTSxTQUEvQixFQUFQLENBQWQ7QUFDQSxZQUFJLE9BQU8sSUFBWDtBQUNBLGdCQUFRLElBQVIsQ0FBYSxVQUFTLEdBQVQsRUFBYTtBQUN0QixpQkFBSyxVQUFMLENBQWdCLEdBQWhCO0FBQ0EsY0FBRSxxQkFBRixFQUF5QixJQUF6QjtBQUNBLGNBQUUsY0FBRixFQUFrQixJQUFsQjtBQUNILFNBSkQ7QUFLSDs7QUFFRCxvQkFBZ0I7QUFDWixZQUFJLFlBQVksRUFBRSxhQUFGLENBQWhCO0FBQ0EsWUFBSSxTQUFTLFVBQVUsSUFBVixDQUFlLFdBQWYsQ0FBYjtBQUNBLGVBQVEsVUFBVSxNQUFWLElBQW9CLE9BQU8sTUFBNUIsR0FBc0MsT0FBTyxJQUFQLENBQVksTUFBWixFQUFvQixJQUFwQixHQUEyQixJQUEzQixFQUF0QyxHQUEwRSxJQUFqRjtBQUNIOztBQUVELGlCQUFhLEVBQWIsRUFBaUI7QUFDYixZQUFJLFFBQVEsRUFBRSxvQkFBRixDQUFaO0FBQ0EsWUFBSSxPQUFPLEVBQUcsZUFBYSxFQUFHLEdBQW5CLENBQVg7O0FBRUEsVUFBRyxVQUFRLEVBQUcsR0FBZCxFQUFpQixRQUFqQixDQUEwQixjQUExQjs7QUFFQSxjQUFNLElBQU4sQ0FBVyxXQUFYLEVBQXdCLEVBQXhCO0FBQ0EsY0FBTSxJQUFOLENBQVcsc0JBQVgsRUFBbUMsSUFBbkMsQ0FBd0MsS0FBSyxJQUFMLEdBQVksSUFBWixFQUF4QztBQUNBLGNBQU0sU0FBTjtBQUNIOztBQUVELG1CQUFlO0FBQ1gsWUFBSSxRQUFRLEVBQUUsb0JBQUYsQ0FBWjtBQUNBLFlBQUksS0FBSyxNQUFNLElBQU4sQ0FBVyxXQUFYLENBQVQ7QUFDQSxVQUFHLFVBQVEsRUFBRyxHQUFkLEVBQWlCLFdBQWpCLENBQTZCLGNBQTdCO0FBQ0EsY0FBTSxVQUFOO0FBQ0g7O0FBRUQsYUFBUztBQUNMLFlBQUksUUFBUSxFQUFFLG9CQUFGLENBQVo7QUFDQSxZQUFJLEtBQUssTUFBTSxJQUFOLENBQVcsV0FBWCxDQUFUO0FBQ0EsWUFBSSxNQUFPLEtBQUssYUFBTCxFQUFELEdBQTBCLFNBQU8sRUFBRyxXQUFRLEtBQUssYUFBTCxFQUFxQixHQUFqRSxHQUMwQixTQUFPLEVBQUcsR0FEOUM7QUFFQSxZQUFJLFVBQVUsRUFBRSxJQUFGLENBQU8sRUFBQyxLQUFLLEdBQU4sRUFBVyxNQUFNLFFBQWpCLEVBQTJCLE1BQU0sRUFBQyxRQUFRLEVBQUUsU0FBRixFQUFhLEdBQWIsRUFBVCxFQUFqQyxFQUFQLENBQWQ7QUFDQSxZQUFJLE9BQU8sSUFBWDs7QUFFQSxnQkFBUSxJQUFSLENBQWEsVUFBUyxHQUFULEVBQWE7QUFDdEIsa0JBQU0sVUFBTjtBQUNBLGlCQUFLLFVBQUwsQ0FBZ0IsR0FBaEI7QUFDSCxTQUhEO0FBSUg7O0FBRUQsZUFBVyxHQUFYLEVBQWdCO0FBQ1osWUFBSSxPQUFPLEVBQUUsWUFBRixDQUFYO0FBQ0EsWUFBSSxhQUFhLEtBQUssSUFBTCxDQUFVLFVBQVYsRUFBc0IsSUFBdEIsQ0FBMkIsV0FBM0IsQ0FBakI7QUFDQSxhQUFLLEtBQUw7O0FBRUEsWUFBSSxJQUFJLElBQUosQ0FBUyxNQUFiLEVBQXFCO0FBQ2pCLGlCQUFLLElBQUksQ0FBVCxJQUFjLElBQUksSUFBbEIsRUFBd0I7QUFDcEIsOEJBQWMsS0FBSyxFQUFMLENBQVEsSUFBSSxJQUFKLENBQVMsQ0FBVCxDQUFSLENBQWQ7QUFDSDs7QUFFRCxpQkFBSyxNQUFMLENBQVksVUFBWjtBQUNBLGlCQUFLLGdCQUFMLENBQXNCLEdBQXRCO0FBQ0gsU0FQRCxNQU9PO0FBQ0gsaUJBQUssTUFBTCxDQUFZLFVBQVo7QUFDQSxpQkFBSyxNQUFMLENBQWE7OzhCQUFiO0FBR0g7QUFDSjs7QUFFRCxxQkFBaUIsR0FBakIsRUFBc0I7QUFDbEIsWUFBSSxhQUFhLEVBQWpCOztBQUVBLFlBQUssQ0FBRSxFQUFFLGFBQUYsRUFBaUIsTUFBbkIsSUFBNkIsSUFBSSxJQUFKLENBQVMsTUFBM0MsRUFBbUQ7QUFDL0Msb0JBQVEsR0FBUixDQUFZLHNCQUFaO0FBQ0EsY0FBRSx1QkFBRixFQUEyQixNQUEzQixDQUFtQyw4QkFBbkM7QUFDSDs7QUFFRCxZQUFJLFlBQVksRUFBRSxhQUFGLENBQWhCOztBQUdBLFlBQUksSUFBSSxJQUFKLENBQVMsTUFBYixFQUFxQjs7QUFFakIsc0JBQVUsS0FBVjs7QUFFQSxnQkFBSSxJQUFJLFNBQUosR0FBZ0IsQ0FBcEIsRUFBdUI7O0FBRW5CLG9CQUFJLE1BQU0sU0FBUyxRQUFULEdBQW9CLElBQXBCLEdBQTJCLFNBQVMsSUFBOUM7O0FBRUEsb0JBQUksT0FBUSxJQUFJLGFBQUosS0FBc0IsSUFBdkIsR0FDSiw0QkFESSxHQUVKLGlCQUFlLElBQUksYUFBYyxrQkFGeEM7O0FBSUEsb0JBQUksT0FBUSxJQUFJLGFBQUosS0FBc0IsSUFBdkIsR0FDSiw0QkFESSxHQUVKLGlCQUFlLElBQUksYUFBYyxrQkFGeEM7O0FBSUEsOEJBQWMsSUFBZDs7QUFFQSxxQkFBSyxJQUFJLElBQUksQ0FBYixFQUFnQixLQUFLLElBQUksU0FBekIsRUFBb0MsR0FBcEMsRUFBeUM7O0FBRXJDLHdCQUFJLEtBQU0saUJBQWUsR0FBSSxXQUFRLENBQUUsT0FBSSxDQUFFLFlBQTdDOztBQUVBLHdCQUFJLElBQUksWUFBSixJQUFvQixDQUF4QixFQUEyQjtBQUN2Qiw2QkFBTSw0Q0FBMEMsQ0FBRSxlQUFsRDtBQUNIOztBQUVELGtDQUFjLEVBQWQ7QUFDSDs7QUFFRCw4QkFBYyxJQUFkO0FBQ0EsMEJBQVUsTUFBVixDQUFpQixVQUFqQjtBQUNIO0FBRUo7QUFFSjs7QUFFRCxPQUFJLEdBQUosRUFBUztBQUNMLFlBQUksUUFBUSxFQUFFLFNBQUYsRUFBYSxHQUFiLEVBQVo7O0FBRUEsZUFBUSxpQkFBZSxJQUFJLEVBQUc7b0NBQUEsQ0FDRixJQUFJLEVBQUc7OENBQUEsQ0FDRyxJQUFJLEVBQUcsT0FBSSxJQUFJLElBQUs7Ozs7MkNBQUEsQ0FJdkIsSUFBSSxFQUFHOzs7OzsyQ0FBQSxDQUtQLElBQUksRUFBRzs7Ozs7b0NBQUEsQ0FLZCxJQUFJLEVBQUc7OENBQUEsQ0FDRyxJQUFJLEVBQUc7d0VBQUEsQ0FDbUIsS0FBTTs7OzBGQUFBLENBR1ksSUFBSSxFQUFHOzsyREFBQSxDQUV0QyxJQUFJLEVBQUc7Ozs7O3lEQUFBLENBS1QsSUFBSSxFQUFHOzs7OztrRUFBQSxDQUtFLElBQUksRUFBRzs7Ozs7Ozs7O3NCQWpDakU7QUEyQ0g7O0FBbFBNOztBQXNQWCxPQUFPLE9BQVAsR0FBaUIsSUFBSSxJQUFKLEVBQWpCOzs7OztBQ3RQQSxJQUFJLE9BQU8sUUFBUSxvQkFBUixDQUFYOztBQUVBLEVBQUUsUUFBRixFQUFZLEVBQVosQ0FBZSxPQUFmLEVBQXdCLGNBQXhCLEVBQXdDLFVBQVMsQ0FBVCxFQUFXO0FBQy9DLE1BQUUsY0FBRjtBQUNBLFlBQVEsR0FBUixDQUFZLFFBQVo7QUFDQSxNQUFFLGNBQUYsRUFBa0IsSUFBbEI7QUFDQSxTQUFLLE1BQUw7QUFDSCxDQUxEOztBQU9BLEVBQUUsUUFBRixFQUFZLEVBQVosQ0FBZSxPQUFmLEVBQXdCLHFCQUF4QixFQUErQyxVQUFTLENBQVQsRUFBVztBQUN0RCxNQUFFLGNBQUY7QUFDQSxZQUFRLEdBQVIsQ0FBWSxvQkFBWjtBQUNBLFNBQUssWUFBTDtBQUNILENBSkQ7O0FBTUEsRUFBRSxRQUFGLEVBQVksRUFBWixDQUFlLE9BQWYsRUFBd0IsYUFBeEIsRUFBdUMsVUFBUyxDQUFULEVBQVc7QUFDOUMsTUFBRSxjQUFGO0FBQ0EsWUFBUSxHQUFSLENBQVksUUFBWjtBQUNBLFNBQUssS0FBTDtBQUNILENBSkQ7O0FBTUEsRUFBRSxRQUFGLEVBQVksRUFBWixDQUFlLFVBQWYsRUFBMkIsT0FBM0IsRUFBb0MsVUFBUyxDQUFULEVBQVk7O0FBRTVDLFFBQUksRUFBRSxPQUFGLElBQWEsRUFBakIsRUFBcUI7QUFDakIsVUFBRSxjQUFGO0FBQ0EsWUFBSSxLQUFLLEVBQUUsSUFBRixFQUFRLElBQVIsQ0FBYSxTQUFiLENBQVQ7O0FBRUEsWUFBSSxFQUFFLFNBQUYsRUFBYSxNQUFqQixFQUF5QjtBQUNyQixpQkFBSyxLQUFMO0FBQ0gsU0FGRCxNQUVPO0FBQ0gsaUJBQUssTUFBTCxDQUFZLEVBQVo7QUFDSDs7QUFFRCxlQUFPLEtBQVA7QUFDSCxLQVhELE1BV08sSUFBSSxFQUFFLE9BQUYsSUFBYSxFQUFqQixFQUFxQjtBQUN4QixZQUFJLEtBQUssRUFBRSxJQUFGLEVBQVEsSUFBUixDQUFhLFNBQWIsQ0FBVDtBQUNBLFlBQUksTUFBTSxDQUFWLEVBQWE7QUFDVCxpQkFBSyxZQUFMO0FBQ0gsU0FGRCxNQUVPO0FBQ0gsaUJBQUssVUFBTCxDQUFnQixFQUFoQjtBQUNIO0FBQ0o7QUFFSixDQXRCRDs7QUF3QkEsRUFBRSxRQUFGLEVBQVksRUFBWixDQUFlLE9BQWYsRUFBd0IsWUFBeEIsRUFBc0MsVUFBUyxDQUFULEVBQVc7QUFDN0MsTUFBRSxjQUFGO0FBQ0EsWUFBUSxHQUFSLENBQVksTUFBWjtBQUNBLFFBQUksS0FBSyxFQUFFLElBQUYsRUFBUSxJQUFSLENBQWEsU0FBYixDQUFUO0FBQ0EsU0FBSyxJQUFMLENBQVUsRUFBVjtBQUNILENBTEQ7O0FBT0EsRUFBRSxRQUFGLEVBQVksRUFBWixDQUFlLE9BQWYsRUFBd0IsbUJBQXhCLEVBQTZDLFVBQVMsQ0FBVCxFQUFXO0FBQ3BELE1BQUUsY0FBRjtBQUNBLFlBQVEsR0FBUixDQUFZLGFBQVo7QUFDQSxRQUFJLEtBQUssRUFBRSxJQUFGLEVBQVEsSUFBUixDQUFhLFNBQWIsQ0FBVDtBQUNBLFNBQUssVUFBTCxDQUFnQixFQUFoQjtBQUNILENBTEQ7O0FBT0EsRUFBRSxRQUFGLEVBQVksRUFBWixDQUFlLE9BQWYsRUFBd0IsY0FBeEIsRUFBd0MsVUFBUyxDQUFULEVBQVc7QUFDL0MsTUFBRSxjQUFGO0FBQ0EsWUFBUSxHQUFSLENBQVksUUFBWjtBQUNBLFFBQUksS0FBSyxFQUFFLElBQUYsRUFBUSxJQUFSLENBQWEsU0FBYixDQUFUO0FBQ0EsU0FBSyxNQUFMLENBQVksRUFBWjtBQUNILENBTEQ7O0FBT0EsRUFBRSxRQUFGLEVBQVksRUFBWixDQUFlLE9BQWYsRUFBd0IscUJBQXhCLEVBQStDLFVBQVMsQ0FBVCxFQUFXO0FBQ3RELE1BQUUsY0FBRjtBQUNBLFlBQVEsR0FBUixDQUFZLGVBQVo7QUFDQSxRQUFJLEtBQUssRUFBRSxJQUFGLEVBQVEsSUFBUixDQUFhLFNBQWIsQ0FBVDtBQUNBLFNBQUssWUFBTCxDQUFrQixFQUFsQjtBQUNILENBTEQ7O0FBT0EsRUFBRSxRQUFGLEVBQVksRUFBWixDQUFlLE9BQWYsRUFBd0IscUJBQXhCLEVBQStDLFVBQVMsQ0FBVCxFQUFXO0FBQ3RELE1BQUUsY0FBRjtBQUNBLFNBQUssWUFBTDtBQUNILENBSEQ7O0FBS0EsRUFBRSxRQUFGLEVBQVksRUFBWixDQUFlLE9BQWYsRUFBd0IsY0FBeEIsRUFBd0MsVUFBUyxDQUFULEVBQVc7QUFDL0MsTUFBRSxjQUFGO0FBQ0EsWUFBUSxHQUFSLENBQVksUUFBWjtBQUNBLFNBQUssTUFBTDtBQUNILENBSkQ7O0FBTUEsRUFBRSxNQUFGLEVBQVUsRUFBVixDQUFhLE9BQWIsRUFBc0IsZUFBdEIsRUFBdUMsVUFBVSxDQUFWLEVBQWE7QUFDaEQsTUFBRSxhQUFGLEVBQWlCLElBQWpCLENBQXNCLElBQXRCLEVBQTRCLFdBQTVCLENBQXdDLGlCQUF4QztBQUNBLE1BQUUsSUFBRixFQUFRLE1BQVIsR0FBaUIsUUFBakIsQ0FBMEIsUUFBMUI7QUFDQSxTQUFLLEdBQUwsQ0FBUyxFQUFFLElBQUYsRUFBUSxJQUFSLENBQWEsTUFBYixFQUFxQixLQUFyQixDQUEyQixPQUEzQixFQUFvQyxDQUFwQyxDQUFUO0FBQ0EsTUFBRSxjQUFGO0FBQ0gsQ0FMRDs7QUFPQSxFQUFFLFFBQUYsRUFBWSxLQUFaLENBQWtCLFlBQVU7QUFDeEIsTUFBRSxxQkFBRixFQUF5QixTQUF6QixDQUFtQyxFQUFDLGFBQWEsS0FBZCxFQUFuQztBQUNBLFNBQUssR0FBTCxDQUFTLENBQVQ7QUFDSCxDQUhEIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIlxyXG5cclxuY2xhc3MgVG9kbyB7XHJcbiAgICBcclxuICAgIGFsbCAocGFnZSkge1xyXG4gICAgICAgIFxyXG4gICAgICAgIGxldCByZXF1ZXN0ID0gJC5hamF4KHt1cmwgOiAndG9kbz9wYWdlPScgKyBwYWdlLCBkYXRhVHlwZTogJ2pzb24nfSk7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHJlcXVlc3QuZG9uZShmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgIHNlbGYucmVuZGVyVG9kbyhyZXMpO1xyXG4gICAgICAgIH0pLmZhaWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBhbGVydCgnUG9zdHMgY291bGQgbm90IGJlIGxvYWRlZC4nKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGUoaWQpIHtcclxuICAgICAgICBsZXQgZm9ybSA9ICQoYCN0YXNrX2Zvcm1fJHtpZH1gKTtcclxuICAgICAgICBsZXQgcmVxdWVzdCA9ICQuYWpheCh7dXJsOiAndG9kby8nICsgaWQsIHR5cGU6ICdwYXRjaCcsIGRhdGE6IGZvcm0uc2VyaWFsaXplKCl9KTtcclxuXHJcbiAgICAgICAgcmVxdWVzdC5kb25lKGZ1bmN0aW9uKHJlcyl7XHJcbiAgICAgICAgICAgICQoYCN0YXNrX3NwYW5fJHtpZH1gKS5odG1sKHJlcy50YXNrKTtcclxuICAgICAgICAgICAgJCgnI3ZpZXdfJyArIGlkKS5zaG93KCk7XHJcbiAgICAgICAgICAgICQoJyNlZGl0XycgKyBpZCkuaGlkZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGVkaXRDYW5jZWwoaWQpIHtcclxuICAgICAgICBsZXQgdGV4dCA9ICQoJyN0YXNrX3NwYW5fJyArIGlkKS5odG1sKCk7XHJcbiAgICAgICAgJChgI3Rhc2tfaW5wdXRfJHtpZH1gKS52YWwodGV4dC50cmltKCkpO1xyXG4gICAgICAgICQoJyNlZGl0XycgKyBpZCkuaGlkZSgpO1xyXG4gICAgICAgICQoJyN2aWV3XycgKyBpZCkuc2hvdygpO1xyXG4gICAgfVxyXG5cclxuICAgIGVkaXQoaWQpIHtcclxuICAgICAgICBsZXQgdGV4dCA9ICQoJyN0YXNrX3NwYW5fJyArIGlkKS5odG1sKCk7XHJcbiAgICAgICAgJCgnI3ZpZXdfJyArIGlkKS5oaWRlKCk7XHJcbiAgICAgICAgJCgnI2VkaXRfJyArIGlkKS5zaG93KCk7XHJcbiAgICAgICAgJChgI3Rhc2tfaW5wdXRfJHtpZH1gKS52YWwodGV4dC50cmltKCkpLnNlbGVjdCgpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBjcmVhdGVDYW5jZWwoKSB7XHJcbiAgICAgICAgJCgnLnRhc2stY3JlYXRlLWNhbmNlbCcpLmhpZGUoKTtcclxuICAgICAgICAkKCcjdGFza18wJykucmVtb3ZlKCk7XHJcbiAgICAgICAgJCgnLnRhc2stY3JlYXRlJykuc2hvdygpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZSgpIHtcclxuICAgICAgICAkKCcudGFzay1jcmVhdGUtY2FuY2VsJykuc2hvdygpO1xyXG5cclxuICAgICAgICBsZXQgdG9rZW4gPSAkKCcjX3Rva2VuJykudmFsKCk7XHJcblxyXG4gICAgICAgIGxldCBsaSA9IGA8bGkgaWQ9XCJ0YXNrXzBcIiBjbGFzcz1cImNvbGxlY3Rpb24taXRlbVwiPiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD1cImVkaXRfMFwiIGNsYXNzPVwiZWRpdC1tb2RlXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxmb3JtIGlkPVwidGFza19mb3JtXzBcIiBjbGFzcz1cImNvbCBzMTBcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgbmFtZT1cIl90b2tlblwiIHZhbHVlPVwiJHt0b2tlbn1cIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyb3dcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiaW5wdXQtZmllbGQgY29sIHMxMFwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgcGxhY2Vob2xkZXI9XCJFbnRlciB0YXNrIG5hbWVcIiBpZD1cInRhc2tfaW5wdXRfMFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPVwidGV4dFwiIGNsYXNzPVwidmFsaWRhdGVcIiBuYW1lPVwidGFza1wiIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtdGFzay1pZD1cIjBcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sIHMyXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XCJqYXZhc2NyaXB0OnZvaWQoMClcIiBjbGFzcz1cInNlY29uZGFyeS1jb250ZW50IHRhc2stc3RvcmVcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLXRhc2staWQ9XCIwXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cIm1lZGl1bSBtYXRlcmlhbC1pY29uc1wiPmRvbmU8L2k+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9mb3JtPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgIDwvbGk+YDtcclxuXHJcblxyXG4gICAgICAgICQoJyN0b2RvLWxpc3QnKS5hcHBlbmQobGkpO1xyXG4gICAgICAgICQoJyN0YXNrXzAnKS5maW5kKCcjdGFza19pbnB1dF8wJykuZm9jdXMoKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgc3RvcmUoKSB7XHJcbiAgICAgICAgbGV0IGZvcm1fZGF0YSA9ICQoJyN0YXNrX2Zvcm1fMCcpLnNlcmlhbGl6ZSgpO1xyXG4gICAgICAgIGxldCB1cmwgPSAodGhpcy5nZXRBY3RpdmVQYWdlKCkpID8gYHRvZG8/cGFnZT0ke3RoaXMuZ2V0QWN0aXZlUGFnZSgpfWAgOiAndG9kbyc7XHJcbiAgICAgICAgbGV0IHJlcXVlc3QgPSAkLmFqYXgoe3VybDogdXJsLCB0eXBlOiAncG9zdCcsIGRhdGE6IGZvcm1fZGF0YX0pO1xyXG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcclxuICAgICAgICByZXF1ZXN0LmRvbmUoZnVuY3Rpb24ocmVzKXtcclxuICAgICAgICAgICAgc2VsZi5yZW5kZXJUb2RvKHJlcyk7XHJcbiAgICAgICAgICAgICQoJy50YXNrLWNyZWF0ZS1jYW5jZWwnKS5oaWRlKCk7XHJcbiAgICAgICAgICAgICQoJy50YXNrLWNyZWF0ZScpLnNob3coKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRBY3RpdmVQYWdlKCkge1xyXG4gICAgICAgIGxldCBjb250YWluZXIgPSAkKCcucGFnaW5hdGlvbicpO1xyXG4gICAgICAgIGxldCBhY3RpdmUgPSBjb250YWluZXIuZmluZCgnbGkuYWN0aXZlJyk7XHJcbiAgICAgICAgcmV0dXJuIChjb250YWluZXIubGVuZ3RoICYmIGFjdGl2ZS5sZW5ndGgpID8gYWN0aXZlLmZpbmQoJ3NwYW4nKS5odG1sKCkudHJpbSgpIDogbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBkZWxldGVEaWFsb2coaWQpIHtcclxuICAgICAgICBsZXQgbW9kYWwgPSAkKCcjbW9kYWwtdGFzay1kZWxldGUnKTtcclxuICAgICAgICBsZXQgdGFzayA9ICQoYCN0YXNrX3NwYW5fJHtpZH1gKTtcclxuXHJcbiAgICAgICAgJChgI3Rhc2tfJHtpZH1gKS5hZGRDbGFzcygncmVkIGFjY2VudC0xJyk7XHJcblxyXG4gICAgICAgIG1vZGFsLmRhdGEoJ3RhcmdldC1pZCcsIGlkKTtcclxuICAgICAgICBtb2RhbC5maW5kKCcjdGFzay10by1kZWxldGUtdGV4dCcpLmh0bWwodGFzay5odG1sKCkudHJpbSgpKTtcclxuICAgICAgICBtb2RhbC5vcGVuTW9kYWwoKTtcclxuICAgIH1cclxuXHJcbiAgICBkZWxldGVDYW5jZWwoKSB7XHJcbiAgICAgICAgbGV0IG1vZGFsID0gJCgnI21vZGFsLXRhc2stZGVsZXRlJyk7XHJcbiAgICAgICAgbGV0IGlkID0gbW9kYWwuZGF0YSgndGFyZ2V0LWlkJyk7XHJcbiAgICAgICAgJChgI3Rhc2tfJHtpZH1gKS5yZW1vdmVDbGFzcygncmVkIGFjY2VudC0xJyk7XHJcbiAgICAgICAgbW9kYWwuY2xvc2VNb2RhbCgpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBkZWxldGUoKSB7XHJcbiAgICAgICAgbGV0IG1vZGFsID0gJCgnI21vZGFsLXRhc2stZGVsZXRlJyk7XHJcbiAgICAgICAgbGV0IGlkID0gbW9kYWwuZGF0YSgndGFyZ2V0LWlkJyk7XHJcbiAgICAgICAgbGV0IHVybCA9ICh0aGlzLmdldEFjdGl2ZVBhZ2UoKSkgPyBgdG9kby8ke2lkfT9wYWdlPSR7dGhpcy5nZXRBY3RpdmVQYWdlKCl9YFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogYHRvZG8vJHtpZH1gO1xyXG4gICAgICAgIGxldCByZXF1ZXN0ID0gJC5hamF4KHt1cmw6IHVybCwgdHlwZTogJ2RlbGV0ZScsIGRhdGE6IHtfdG9rZW46ICQoJyNfdG9rZW4nKS52YWwoKX19KTtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHJlcXVlc3QuZG9uZShmdW5jdGlvbihyZXMpe1xyXG4gICAgICAgICAgICBtb2RhbC5jbG9zZU1vZGFsKCk7XHJcbiAgICAgICAgICAgIHNlbGYucmVuZGVyVG9kbyhyZXMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJlbmRlclRvZG8ocmVzKSB7XHJcbiAgICAgICAgbGV0IGxpc3QgPSAkKCcjdG9kby1saXN0Jyk7XHJcbiAgICAgICAgbGV0IGNvbGxlY3Rpb24gPSBsaXN0LmZpbmQoJ2xpOmVxKDApJykucHJvcCgnb3V0ZXJIVE1MJyk7XHJcbiAgICAgICAgbGlzdC5lbXB0eSgpO1xyXG5cclxuICAgICAgICBpZiAocmVzLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgaW4gcmVzLmRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb24gKz0gdGhpcy5saShyZXMuZGF0YVtpXSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxpc3QuYXBwZW5kKGNvbGxlY3Rpb24pO1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlclBhZ2luYXRpb24ocmVzKVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxpc3QuYXBwZW5kKGNvbGxlY3Rpb24pO1xyXG4gICAgICAgICAgICBsaXN0LmFwcGVuZChgPGxpIGNsYXNzPVwiY29sbGVjdGlvbi1pdGVtIGdyZXkgbGlnaHRlbi00IGdyZXktdGV4dFwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBbIEFkZCBZb3VyIGZpcnN0IFRhc2sgXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2xpPmApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZW5kZXJQYWdpbmF0aW9uKHJlcykge1xyXG4gICAgICAgIGxldCBwYWdpbmF0aW9uID0gJyc7XHJcblxyXG4gICAgICAgIGlmICggISAkKCcucGFnaW5hdGlvbicpLmxlbmd0aCAmJiByZXMuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NyZWF0ZSBwYWdpbmF0aW9uIHVsJyk7XHJcbiAgICAgICAgICAgICQoJyNwYWdpbmF0aW9uLWNvbnRhaW5lcicpLmFwcGVuZChgPHVsIGNsYXNzPVwicGFnaW5hdGlvblwiPjwvdWw+YClcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBjb250YWluZXIgPSAkKCcucGFnaW5hdGlvbicpO1xyXG5cclxuXHJcbiAgICAgICAgaWYgKHJlcy5kYXRhLmxlbmd0aCkge1xyXG5cclxuICAgICAgICAgICAgY29udGFpbmVyLmVtcHR5KCk7XHJcblxyXG4gICAgICAgICAgICBpZiAocmVzLmxhc3RfcGFnZSA+IDEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgdXJsID0gbG9jYXRpb24ucHJvdG9jb2wgKyBcIi8vXCIgKyBsb2NhdGlvbi5ob3N0O1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBwcmV2ID0gKHJlcy5wcmV2X3BhZ2VfdXJsID09PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgID8gYDxsaT48c3Bhbj4gPDwgPC9zcGFuPjwvbGk+YFxyXG4gICAgICAgICAgICAgICAgICAgIDogYDxsaT48YSBocmVmPVwiJHtyZXMucHJldl9wYWdlX3VybH1cIj4gPDwgPC9hPjwvbGk+YDtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbmV4dCA9IChyZXMubmV4dF9wYWdlX3VybCA9PT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICA/IGA8bGk+PHNwYW4+ID4+IDwvc3Bhbj48L2xpPmBcclxuICAgICAgICAgICAgICAgICAgICA6IGA8bGk+PGEgaHJlZj1cIiR7cmVzLm5leHRfcGFnZV91cmx9XCI+ID4+IDwvYT48L2xpPmA7XHJcblxyXG4gICAgICAgICAgICAgICAgcGFnaW5hdGlvbiArPSBwcmV2O1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHJlcy5sYXN0X3BhZ2U7IGkrKykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBsZXQgbGkgPSBgPGxpPjxhIGhyZWY9XCIke3VybH0/cGFnZT0ke2l9XCI+JHtpfTwvYT48L2xpPmA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXMuY3VycmVudF9wYWdlID09IGkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGkgPSBgPGxpIGNsYXNzPVwiYWN0aXZlXCI+PHNwYW4gY2xhc3M9XCJhY3RpdmVcIj4ke2l9PC9zcGFuPjwvbGk+YDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb24gKz0gbGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcGFnaW5hdGlvbiArPSBuZXh0O1xyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZChwYWdpbmF0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBsaSAocmVzKSB7XHJcbiAgICAgICAgbGV0IHRva2VuID0gJCgnI190b2tlbicpLnZhbCgpO1xyXG5cclxuICAgICAgICByZXR1cm4gYDxsaSBpZD1cInRhc2tfJHtyZXMuaWR9XCIgY2xhc3M9XCJjb2xsZWN0aW9uLWl0ZW1cIj5cclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPVwidmlld18ke3Jlcy5pZH1cIiBjbGFzcz1cInZpZXctbW9kZVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD1cInRhc2tfc3Bhbl8ke3Jlcy5pZH1cIj4ke3Jlcy50YXNrfTwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XCJqYXZhc2NyaXB0OnZvaWQoMClcIiBjbGFzcz1cInNlY29uZGFyeS1jb250ZW50IHRhc2stZGVsZXRlLWRpYWxvZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVkLXRleHQgdGV4dC1hY2NlbnQtMlwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtdGFzay1pZD1cIiR7cmVzLmlkfVwiIHRpdGxlPVwiRGVsZXRlIFRhc2tcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnNcIj5kZWxldGU8L2k+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvYT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XCJqYXZhc2NyaXB0OnZvaWQoMClcIiBjbGFzcz1cInNlY29uZGFyeS1jb250ZW50IHRhc2stZWRpdFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtdGFzay1pZD1cIiR7cmVzLmlkfVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJtYXRlcmlhbC1pY29uc1wiPm1vZGVfZWRpdDwvaT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9hPlxyXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9XCJlZGl0XyR7cmVzLmlkfVwiIGNsYXNzPVwiZWRpdC1tb2RlXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxmb3JtIGlkPVwidGFza19mb3JtXyR7cmVzLmlkfVwiIGNsYXNzPVwiY29sIHMxMFwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBuYW1lPVwiX3Rva2VuXCIgdmFsdWU9XCIke3Rva2VufVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJvd1wiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJpbnB1dC1maWVsZCBjb2wgczEwXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCBwbGFjZWhvbGRlcj1cIkVudGVyIHRhc2sgbmFtZVwiIGlkPVwidGFza19pbnB1dF8ke3Jlcy5pZH1cIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cInRleHRcIiBjbGFzcz1cInZhbGlkYXRlXCIgbmFtZT1cInRhc2tcIiBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtdGFzay1pZD1cIiR7cmVzLmlkfVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wgczJcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBocmVmPVwiamF2YXNjcmlwdDp2b2lkKDApXCIgY2xhc3M9XCJzZWNvbmRhcnktY29udGVudCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2stZWRpdC1jYW5jZWwgcmVkLXRleHQgdGV4dC1hY2NlbnQtMlwiIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtdGFzay1pZD1cIiR7cmVzLmlkfVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJtYXRlcmlhbC1pY29ucyBmb250LTM1XCI+bm90X2ludGVyZXN0ZWQ8L2k+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XCJqYXZhc2NyaXB0OnZvaWQoMClcIiBjbGFzcz1cInNlY29uZGFyeS1jb250ZW50IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay11cGRhdGVcIiBkYXRhLXRhc2staWQ9XCIke3Jlcy5pZH1cIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnMgZm9udC0zNVwiPmRvbmU8L2k+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9mb3JtPlxyXG5cclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgIDwvbGk+YDtcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gbmV3IFRvZG87IiwiLy8kKFwiLmJ1dHRvbi1jb2xsYXBzZVwiKS5zaWRlTmF2KCk7XHJcblxyXG52YXIgVG9kbyA9IHJlcXVpcmUoJy4uL2NvbXBvbmVudHMvVG9kbycpO1xyXG5cclxuJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy50YXNrLWNyZWF0ZScsIGZ1bmN0aW9uKGUpe1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgY29uc29sZS5sb2coJ2NyZWF0ZScpO1xyXG4gICAgJCgnLnRhc2stY3JlYXRlJykuaGlkZSgpO1xyXG4gICAgVG9kby5jcmVhdGUoKTtcclxufSk7XHJcblxyXG4kKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnRhc2stY3JlYXRlLWNhbmNlbCcsIGZ1bmN0aW9uKGUpe1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgY29uc29sZS5sb2coJ3Rhc2stY3JlYXRlLWNhbmNlbCcpO1xyXG4gICAgVG9kby5jcmVhdGVDYW5jZWwoKTtcclxufSk7XHJcblxyXG4kKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnRhc2stc3RvcmUnLCBmdW5jdGlvbihlKXtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnNvbGUubG9nKCdjcmVhdGUnKTtcclxuICAgIFRvZG8uc3RvcmUoKTtcclxufSk7XHJcblxyXG4kKGRvY3VtZW50KS5vbihcImtleXByZXNzXCIsIFwiaW5wdXRcIiwgZnVuY3Rpb24oZSkge1xyXG5cclxuICAgIGlmIChlLmtleUNvZGUgPT0gMTMpIHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgbGV0IGlkID0gJCh0aGlzKS5kYXRhKCd0YXNrLWlkJyk7XHJcblxyXG4gICAgICAgIGlmICgkKCcjdGFza18wJykubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIFRvZG8uc3RvcmUoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBUb2RvLnVwZGF0ZShpZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9IGVsc2UgaWYgKGUua2V5Q29kZSA9PSAyNykge1xyXG4gICAgICAgIGxldCBpZCA9ICQodGhpcykuZGF0YSgndGFzay1pZCcpO1xyXG4gICAgICAgIGlmIChpZCA9PSAwKSB7XHJcbiAgICAgICAgICAgIFRvZG8uY3JlYXRlQ2FuY2VsKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgVG9kby5lZGl0Q2FuY2VsKGlkKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KTtcclxuXHJcbiQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcudGFzay1lZGl0JywgZnVuY3Rpb24oZSl7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBjb25zb2xlLmxvZygnZWRpdCcpO1xyXG4gICAgbGV0IGlkID0gJCh0aGlzKS5kYXRhKCd0YXNrLWlkJyk7XHJcbiAgICBUb2RvLmVkaXQoaWQpO1xyXG59KTtcclxuXHJcbiQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcudGFzay1lZGl0LWNhbmNlbCcsIGZ1bmN0aW9uKGUpe1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgY29uc29sZS5sb2coJ2VkaXQtY2FuY2VsJyk7XHJcbiAgICBsZXQgaWQgPSAkKHRoaXMpLmRhdGEoJ3Rhc2staWQnKTtcclxuICAgIFRvZG8uZWRpdENhbmNlbChpZCk7XHJcbn0pO1xyXG5cclxuJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy50YXNrLXVwZGF0ZScsIGZ1bmN0aW9uKGUpe1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgY29uc29sZS5sb2coJ3VwZGF0ZScpO1xyXG4gICAgbGV0IGlkID0gJCh0aGlzKS5kYXRhKCd0YXNrLWlkJyk7XHJcbiAgICBUb2RvLnVwZGF0ZShpZCk7XHJcbn0pO1xyXG5cclxuJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy50YXNrLWRlbGV0ZS1kaWFsb2cnLCBmdW5jdGlvbihlKXtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnNvbGUubG9nKCdkZWxldGUtZGlhbG9nJyk7XHJcbiAgICBsZXQgaWQgPSAkKHRoaXMpLmRhdGEoJ3Rhc2staWQnKTtcclxuICAgIFRvZG8uZGVsZXRlRGlhbG9nKGlkKTtcclxufSk7XHJcblxyXG4kKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnRhc2stZGVsZXRlLWNhbmNlbCcsIGZ1bmN0aW9uKGUpe1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgVG9kby5kZWxldGVDYW5jZWwoKTtcclxufSk7XHJcblxyXG4kKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnRhc2stZGVsZXRlJywgZnVuY3Rpb24oZSl7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBjb25zb2xlLmxvZygnZGVsZXRlJyk7XHJcbiAgICBUb2RvLmRlbGV0ZSgpO1xyXG59KTtcclxuXHJcbiQoJ21haW4nKS5vbignY2xpY2snLCAnLnBhZ2luYXRpb24gYScsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAkKCcucGFnaW5hdGlvbicpLmZpbmQoJ2xpJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZSBkaXNhYmxlZCcpO1xyXG4gICAgJCh0aGlzKS5wYXJlbnQoKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICBUb2RvLmFsbCgkKHRoaXMpLmF0dHIoJ2hyZWYnKS5zcGxpdCgncGFnZT0nKVsxXSk7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbn0pO1xyXG5cclxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcclxuICAgICQoJy50YXNrLWRlbGV0ZS1kaWFsb2cnKS5sZWFuTW9kYWwoe2Rpc21pc3NpYmxlOiBmYWxzZX0pO1xyXG4gICAgVG9kby5hbGwoMSk7XHJcbn0pOyJdfQ==
