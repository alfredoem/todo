(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){


class Todo {

    all(page) {
        this.createCancel();

        let container = $('#pagination-container');
        container.fadeTo('slow', .6);
        container.append('<div id="container-disabled" class="overlay"></div>');

        let request = $.ajax({ url: 'todo?page=' + page, dataType: 'json' });
        let self = this;
        request.done(function (res) {
            container.fadeTo('slow', 1);
            container.find('#container-disabled').remove();
            self.renderTodo(res);
        }).fail(function () {
            alert('Posts could not be loaded.');
        });
    }

    update(id) {
        let form = $(`#task_form_${ id }`);
        let request = $.ajax({ url: 'todo/' + id, type: 'patch', data: form.serialize() });

        request.done(function (res) {
            $(`#task_span_${ id }`).html(res.task);
            $('#view_' + id).show();
            $('#edit_' + id).hide();
        });
    }

    editCancel(id) {
        let text = $('#task_span_' + id).html();
        $(`#task_input_${ id }`).val(text.trim());
        $('#edit_' + id).hide();
        $('#view_' + id).show();
    }

    edit(id) {
        let text = $('#task_span_' + id).html();
        $('#view_' + id).hide();
        $('#edit_' + id).show();
        $(`#task_input_${ id }`).val(text.trim()).select();
    }

    createCancel() {
        $('.task-create-cancel').hide();
        $('#task_0').remove();
        $('.task-create').show();
    }

    create() {
        $('.task-create-cancel').show();

        let token = $('#_token').val();

        let li = `<li id="task_0" class="collection-item">                    
                    <div id="edit_0" class="edit-mode">
                        <form id="task_form_0" class="col s10">
                            <input type="hidden" name="_token" value="${ token }">
                            <div class="row valign-wrapper">
                                <div class="input-field col s10">
                                    <textarea id="task_input_0" name="task" 
                                    class="materialize-textarea validate"
                                     data-task-id="0" maxlength="255"></textarea>
                                    <label for="task_input_0">Task Description</label>
                                </div>
                                <div class="col s2 valign">
                                    <a href="javascript:void(0)" class="secondary-content task-store"
                                       data-task-id="0">
                                        <i class="medium material-icons">done</i>
                                    </a>
                                </div>
                            </div>

                        </form>
                        
                    </div>
                </li>`;

        $('#todo-list').find('li:eq(0)').after(li);
        $('#task_0').find('#task_input_0').focus();
    }

    store() {
        let input = $('#task_input_0');
        if (input.val().trim()) {

            let form_data = $('#task_form_0').serialize();
            let url = this.getActivePage() ? `todo?page=${ this.getActivePage() }` : 'todo';
            let request = $.ajax({ url: url, type: 'post', data: form_data });
            let self = this;

            request.done(function (res) {
                self.renderTodo(res);
                $('.task-create-cancel').hide();
                $('.task-create').show();
            });
        } else {
            input.addClass('invalid').focus();
        }
    }

    getActivePage() {
        let container = $('.pagination');
        let active = container.find('li.active');
        return container.length && active.length ? active.find('span').html().trim() : null;
    }

    deleteDialog(id) {
        let modal = $('#modal-task-delete');
        let task = $(`#task_span_${ id }`);

        $(`#task_${ id }`).addClass('red accent-1');

        modal.data('target-id', id);
        modal.find('#task-to-delete-text').html(task.html().trim());
        modal.openModal();
    }

    deleteCancel() {
        let modal = $('#modal-task-delete');
        let id = modal.data('target-id');
        $(`#task_${ id }`).removeClass('red accent-1');
        modal.closeModal();
    }

    delete() {
        let modal = $('#modal-task-delete');
        let id = modal.data('target-id');
        let url = this.getActivePage() ? `todo/${ id }?page=${ this.getActivePage() }` : `todo/${ id }`;
        let request = $.ajax({ url: url, type: 'delete', data: { _token: $('#_token').val() } });
        let self = this;

        request.done(function (res) {
            modal.closeModal();
            self.renderTodo(res);
        });
    }

    renderTodo(res) {
        let list = $('#todo-list');
        let collection = list.find('li:eq(0)').prop('outerHTML');
        list.empty();

        if (res.data.length) {
            for (let i in res.data) {
                collection += this.li(res.data[i]);
            }

            list.append(collection);
            this.renderPagination(res);
            $('.task-delete-dialog').leanModal({ dismissible: false });
        } else {
            list.append(collection);
            list.append(`<li class="collection-item grey lighten-4 grey-text">
                        [ Add Your first Task ]
                        </li>`);
        }
    }

    renderPagination(res) {
        let pagination = '';

        if (!$('.pagination').length && res.data.length) {
            console.log('create pagination ul');
            $('#pagination-container').append(`<ul class="pagination"></ul>`);
        }

        let container = $('.pagination');

        if (res.data.length) {

            container.empty();

            if (res.last_page > 1) {

                let url = location.protocol + "//" + location.host;

                let prev = res.prev_page_url === null ? `<li><span> << </span></li>` : `<li><a href="${ res.prev_page_url }"> << </a></li>`;

                let next = res.next_page_url === null ? `<li><span> >> </span></li>` : `<li><a href="${ res.next_page_url }"> >> </a></li>`;

                pagination += prev;

                for (let i = 1; i <= res.last_page; i++) {

                    let li = `<li><a href="${ url }?page=${ i }">${ i }</a></li>`;

                    if (res.current_page == i) {
                        li = `<li class="active"><span class="active">${ i }</span></li>`;
                    }

                    pagination += li;
                }

                pagination += next;
                container.append(pagination);
            }
        }
    }

    li(res) {
        let token = $('#_token').val();

        return `<li id="task_${ res.id }" class="collection-item">
                    <div id="view_${ res.id }" class="view-mode row m0">
                        <div class="text-justify col s12">
                            <span class="break-word" id="task_span_${ res.id }">${ res.task }</span>
                        </div>
                        <div class="right-align col s12">
                            <a href="#modal-task-delete" class="secondary-content task-delete-dialog
                            red-text text-accent-2"
                            data-task-id="${ res.id }" title="Delete Task">
                                <i class="material-icons">delete</i>
                            </a>
                            
                            <a href="javascript:void(0)" class="secondary-content task-edit"
                            data-task-id="${ res.id }">
                                <i class="material-icons">mode_edit</i>
                            </a>
                        </div>  
                    </div>
                    
                    <div id="edit_${ res.id }" class="edit-mode" style="display: none">
                        <form id="task_form_${ res.id }" class="col s10">
                            <input type="hidden" name="_token" value="${ token }">
                            <div class="row valign-wrapper">
                                <div class="input-field col s10">
                                                                                
                                   <textarea id="task_input_${ res.id }" name="task" 
                                    class="materialize-textarea validate" 
                                    data-task-id="${ res.id }"
                                    maxlength="255"></textarea>
                                </div>
                                <div class="col s2 valign">
                                    <a href="javascript:void(0)" class="secondary-content 
                                        task-edit-cancel red-text text-accent-2" 
                                         data-task-id="${ res.id }">
                                        <i class="material-icons font-35">not_interested</i>
                                    </a>
                                    
                                    <a href="javascript:void(0)" class="secondary-content 
                                     task-update" data-task-id="${ res.id }">
                                        <i class="material-icons font-35">done</i>
                                    </a>
                                </div>
                            </div>

                        </form>

                    </div>
                </li>`;
    }

}

module.exports = new Todo();

},{}],2:[function(require,module,exports){
//$(".button-collapse").sideNav();

var Todo = require('../components/Todo');

$(document).on('click', '.task-create', function (e) {
    e.preventDefault();
    console.log('create');
    $('.task-create').hide();
    Todo.create();
});

$(document).on('click', '.task-create-cancel', function (e) {
    e.preventDefault();
    console.log('task-create-cancel');
    Todo.createCancel();
});

$(document).on('click', '.task-store', function (e) {
    e.preventDefault();
    console.log('create');
    Todo.store();
});

$(document).on("keypress", "textarea", function (e) {

    if (e.keyCode == 13) {
        e.preventDefault();
        let id = $(this).data('task-id');

        if ($('#task_0').length) {
            Todo.store();
        } else {
            Todo.update(id);
        }

        return false;
    } else if (e.keyCode == 27) {
        let id = $(this).data('task-id');
        if (id == 0) {
            Todo.createCancel();
        } else {
            Todo.editCancel(id);
        }
    }
});

$(document).on('click', '.task-edit', function (e) {
    e.preventDefault();
    console.log('edit');
    let id = $(this).data('task-id');
    Todo.edit(id);
});

$(document).on('click', '.task-edit-cancel', function (e) {
    e.preventDefault();
    console.log('edit-cancel');
    let id = $(this).data('task-id');
    Todo.editCancel(id);
});

$(document).on('click', '.task-update', function (e) {
    e.preventDefault();
    console.log('update');
    let id = $(this).data('task-id');
    Todo.update(id);
});

$(document).on('click', '.task-delete-dialog', function (e) {
    e.preventDefault();
    console.log('delete-dialog');
    let id = $(this).data('task-id');
    Todo.deleteDialog(id);
});

$(document).on('click', '.task-delete-cancel', function (e) {
    e.preventDefault();
    Todo.deleteCancel();
});

$(document).on('click', '.task-delete', function (e) {
    e.preventDefault();
    console.log('delete');
    Todo.delete();
});

$('main').on('click', '.pagination a', function (e) {
    $('.pagination').find('li').removeClass('active disabled');
    $(this).parent().addClass('active');
    Todo.all($(this).attr('href').split('page=')[1]);
    e.preventDefault();
});

$(document).ready(function () {
    Todo.all(1);
});

},{"../components/Todo":1}]},{},[2])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJyZXNvdXJjZXNcXGFzc2V0c1xcanNcXGNvbXBvbmVudHNcXFRvZG8uanMiLCJyZXNvdXJjZXNcXGFzc2V0c1xcanNcXG1haW5cXGluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNFQSxNQUFNLElBQU4sQ0FBVzs7QUFFUCxRQUFLLElBQUwsRUFBVztBQUNQLGFBQUssWUFBTDs7QUFFQSxZQUFJLFlBQVksRUFBRSx1QkFBRixDQUFoQjtBQUNBLGtCQUFVLE1BQVYsQ0FBaUIsTUFBakIsRUFBeUIsRUFBekI7QUFDQSxrQkFBVSxNQUFWLENBQWlCLHFEQUFqQjs7QUFFQSxZQUFJLFVBQVUsRUFBRSxJQUFGLENBQU8sRUFBQyxLQUFNLGVBQWUsSUFBdEIsRUFBNEIsVUFBVSxNQUF0QyxFQUFQLENBQWQ7QUFDQSxZQUFJLE9BQU8sSUFBWDtBQUNBLGdCQUFRLElBQVIsQ0FBYSxVQUFVLEdBQVYsRUFBZTtBQUN4QixzQkFBVSxNQUFWLENBQWlCLE1BQWpCLEVBQXlCLENBQXpCO0FBQ0Esc0JBQVUsSUFBVixDQUFlLHFCQUFmLEVBQXNDLE1BQXRDO0FBQ0EsaUJBQUssVUFBTCxDQUFnQixHQUFoQjtBQUNILFNBSkQsRUFJRyxJQUpILENBSVEsWUFBWTtBQUNoQixrQkFBTSw0QkFBTjtBQUNILFNBTkQ7QUFPSDs7QUFFRCxXQUFPLEVBQVAsRUFBVztBQUNQLFlBQUksT0FBTyxFQUFHLGVBQWEsRUFBRyxHQUFuQixDQUFYO0FBQ0EsWUFBSSxVQUFVLEVBQUUsSUFBRixDQUFPLEVBQUMsS0FBSyxVQUFVLEVBQWhCLEVBQW9CLE1BQU0sT0FBMUIsRUFBbUMsTUFBTSxLQUFLLFNBQUwsRUFBekMsRUFBUCxDQUFkOztBQUVBLGdCQUFRLElBQVIsQ0FBYSxVQUFTLEdBQVQsRUFBYTtBQUN0QixjQUFHLGVBQWEsRUFBRyxHQUFuQixFQUFzQixJQUF0QixDQUEyQixJQUFJLElB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O0FBQ0EsU0FBSyxHQUFMLENBQVMsRUFBRSxJQUFGLEVBQVEsSUFBUixDQUFhLE1BQWIsRUFBcUIsS0FBckIsQ0FBMkIsT0FBM0IsRUFBb0MsQ0FBcEMsQ0FBVDtBQUNBLE1BQUUsY0FBRjtBQUNILENBTEQ7O0FBT0EsRUFBRSxRQUFGLEVBQVksS0FBWixDQUFrQixZQUFVO0FBQ3hCLFNBQUssR0FBTCxDQUFTLENBQVQ7QUFDSCxDQUZEIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIlxyXG5cclxuY2xhc3MgVG9kbyB7XHJcbiAgICBcclxuICAgIGFsbCAocGFnZSkge1xyXG4gICAgICAgIHRoaXMuY3JlYXRlQ2FuY2VsKCk7XHJcblxyXG4gICAgICAgIGxldCBjb250YWluZXIgPSAkKCcjcGFnaW5hdGlvbi1jb250YWluZXInKTtcclxuICAgICAgICBjb250YWluZXIuZmFkZVRvKCdzbG93JywgLjYpO1xyXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmQoJzxkaXYgaWQ9XCJjb250YWluZXItZGlzYWJsZWRcIiBjbGFzcz1cIm92ZXJsYXlcIj48L2Rpdj4nKTtcclxuXHJcbiAgICAgICAgbGV0IHJlcXVlc3QgPSAkLmFqYXgoe3VybCA6ICd0b2RvP3BhZ2U9JyArIHBhZ2UsIGRhdGFUeXBlOiAnanNvbid9KTtcclxuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgcmVxdWVzdC5kb25lKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICAgICAgY29udGFpbmVyLmZhZGVUbygnc2xvdycsIDEpO1xyXG4gICAgICAgICAgICBjb250YWluZXIuZmluZCgnI2NvbnRhaW5lci1kaXNhYmxlZCcpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICBzZWxmLnJlbmRlclRvZG8ocmVzKTtcclxuICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgYWxlcnQoJ1Bvc3RzIGNvdWxkIG5vdCBiZSBsb2FkZWQuJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlKGlkKSB7XHJcbiAgICAgICAgbGV0IGZvcm0gPSAkKGAjdGFza19mb3JtXyR7aWR9YCk7XHJcbiAgICAgICAgbGV0IHJlcXVlc3QgPSAkLmFqYXgoe3VybDogJ3RvZG8vJyArIGlkLCB0eXBlOiAncGF0Y2gnLCBkYXRhOiBmb3JtLnNlcmlhbGl6ZSgpfSk7XHJcblxyXG4gICAgICAgIHJlcXVlc3QuZG9uZShmdW5jdGlvbihyZXMpe1xyXG4gICAgICAgICAgICAkKGAjdGFza19zcGFuXyR7aWR9YCkuaHRtbChyZXMudGFzayk7XHJcbiAgICAgICAgICAgICQoJyN2aWV3XycgKyBpZCkuc2hvdygpO1xyXG4gICAgICAgICAgICAkKCcjZWRpdF8nICsgaWQpLmhpZGUoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBlZGl0Q2FuY2VsKGlkKSB7XHJcbiAgICAgICAgbGV0IHRleHQgPSAkKCcjdGFza19zcGFuXycgKyBpZCkuaHRtbCgpO1xyXG4gICAgICAgICQoYCN0YXNrX2lucHV0XyR7aWR9YCkudmFsKHRleHQudHJpbSgpKTtcclxuICAgICAgICAkKCcjZWRpdF8nICsgaWQpLmhpZGUoKTtcclxuICAgICAgICAkKCcjdmlld18nICsgaWQpLnNob3coKTtcclxuICAgIH1cclxuXHJcbiAgICBlZGl0KGlkKSB7XHJcbiAgICAgICAgbGV0IHRleHQgPSAkKCcjdGFza19zcGFuXycgKyBpZCkuaHRtbCgpO1xyXG4gICAgICAgICQoJyN2aWV3XycgKyBpZCkuaGlkZSgpO1xyXG4gICAgICAgICQoJyNlZGl0XycgKyBpZCkuc2hvdygpO1xyXG4gICAgICAgICQoYCN0YXNrX2lucHV0XyR7aWR9YCkudmFsKHRleHQudHJpbSgpKS5zZWxlY3QoKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY3JlYXRlQ2FuY2VsKCkge1xyXG4gICAgICAgICQoJy50YXNrLWNyZWF0ZS1jYW5jZWwnKS5oaWRlKCk7XHJcbiAgICAgICAgJCgnI3Rhc2tfMCcpLnJlbW92ZSgpO1xyXG4gICAgICAgICQoJy50YXNrLWNyZWF0ZScpLnNob3coKTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGUoKSB7XHJcbiAgICAgICAgJCgnLnRhc2stY3JlYXRlLWNhbmNlbCcpLnNob3coKTtcclxuXHJcbiAgICAgICAgbGV0IHRva2VuID0gJCgnI190b2tlbicpLnZhbCgpO1xyXG5cclxuICAgICAgICBsZXQgbGkgPSBgPGxpIGlkPVwidGFza18wXCIgY2xhc3M9XCJjb2xsZWN0aW9uLWl0ZW1cIj4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9XCJlZGl0XzBcIiBjbGFzcz1cImVkaXQtbW9kZVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8Zm9ybSBpZD1cInRhc2tfZm9ybV8wXCIgY2xhc3M9XCJjb2wgczEwXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cImhpZGRlblwiIG5hbWU9XCJfdG9rZW5cIiB2YWx1ZT1cIiR7dG9rZW59XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicm93IHZhbGlnbi13cmFwcGVyXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImlucHV0LWZpZWxkIGNvbCBzMTBcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRleHRhcmVhIGlkPVwidGFza19pbnB1dF8wXCIgbmFtZT1cInRhc2tcIiBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9XCJtYXRlcmlhbGl6ZS10ZXh0YXJlYSB2YWxpZGF0ZVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLXRhc2staWQ9XCIwXCIgbWF4bGVuZ3RoPVwiMjU1XCI+PC90ZXh0YXJlYT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj1cInRhc2tfaW5wdXRfMFwiPlRhc2sgRGVzY3JpcHRpb248L2xhYmVsPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wgczIgdmFsaWduXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XCJqYXZhc2NyaXB0OnZvaWQoMClcIiBjbGFzcz1cInNlY29uZGFyeS1jb250ZW50IHRhc2stc3RvcmVcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLXRhc2staWQ9XCIwXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cIm1lZGl1bSBtYXRlcmlhbC1pY29uc1wiPmRvbmU8L2k+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9mb3JtPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgIDwvbGk+YDtcclxuXHJcblxyXG4gICAgICAgICQoJyN0b2RvLWxpc3QnKS5maW5kKCdsaTplcSgwKScpLmFmdGVyKGxpKTtcclxuICAgICAgICAkKCcjdGFza18wJykuZmluZCgnI3Rhc2tfaW5wdXRfMCcpLmZvY3VzKCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHN0b3JlKCkge1xyXG4gICAgICAgIGxldCBpbnB1dCA9ICQoJyN0YXNrX2lucHV0XzAnKTtcclxuICAgICAgICBpZiAoaW5wdXQudmFsKCkudHJpbSgpKSB7XHJcblxyXG4gICAgICAgICAgICBsZXQgZm9ybV9kYXRhID0gJCgnI3Rhc2tfZm9ybV8wJykuc2VyaWFsaXplKCk7XHJcbiAgICAgICAgICAgIGxldCB1cmwgPSAodGhpcy5nZXRBY3RpdmVQYWdlKCkpID8gYHRvZG8/cGFnZT0ke3RoaXMuZ2V0QWN0aXZlUGFnZSgpfWAgOiAndG9kbyc7XHJcbiAgICAgICAgICAgIGxldCByZXF1ZXN0ID0gJC5hamF4KHt1cmw6IHVybCwgdHlwZTogJ3Bvc3QnLCBkYXRhOiBmb3JtX2RhdGF9KTtcclxuICAgICAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICAgICAgcmVxdWVzdC5kb25lKGZ1bmN0aW9uKHJlcyl7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnJlbmRlclRvZG8ocmVzKTtcclxuICAgICAgICAgICAgICAgICQoJy50YXNrLWNyZWF0ZS1jYW5jZWwnKS5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAkKCcudGFzay1jcmVhdGUnKS5zaG93KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlucHV0LmFkZENsYXNzKCdpbnZhbGlkJykuZm9jdXMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0QWN0aXZlUGFnZSgpIHtcclxuICAgICAgICBsZXQgY29udGFpbmVyID0gJCgnLnBhZ2luYXRpb24nKTtcclxuICAgICAgICBsZXQgYWN0aXZlID0gY29udGFpbmVyLmZpbmQoJ2xpLmFjdGl2ZScpO1xyXG4gICAgICAgIHJldHVybiAoY29udGFpbmVyLmxlbmd0aCAmJiBhY3RpdmUubGVuZ3RoKSA/IGFjdGl2ZS5maW5kKCdzcGFuJykuaHRtbCgpLnRyaW0oKSA6IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlRGlhbG9nKGlkKSB7XHJcbiAgICAgICAgbGV0IG1vZGFsID0gJCgnI21vZGFsLXRhc2stZGVsZXRlJyk7XHJcbiAgICAgICAgbGV0IHRhc2sgPSAkKGAjdGFza19zcGFuXyR7aWR9YCk7XHJcblxyXG4gICAgICAgICQoYCN0YXNrXyR7aWR9YCkuYWRkQ2xhc3MoJ3JlZCBhY2NlbnQtMScpO1xyXG5cclxuICAgICAgICBtb2RhbC5kYXRhKCd0YXJnZXQtaWQnLCBpZCk7XHJcbiAgICAgICAgbW9kYWwuZmluZCgnI3Rhc2stdG8tZGVsZXRlLXRleHQnKS5odG1sKHRhc2suaHRtbCgpLnRyaW0oKSk7XHJcbiAgICAgICAgbW9kYWwub3Blbk1vZGFsKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZGVsZXRlQ2FuY2VsKCkge1xyXG4gICAgICAgIGxldCBtb2RhbCA9ICQoJyNtb2RhbC10YXNrLWRlbGV0ZScpO1xyXG4gICAgICAgIGxldCBpZCA9IG1vZGFsLmRhdGEoJ3RhcmdldC1pZCcpO1xyXG4gICAgICAgICQoYCN0YXNrXyR7aWR9YCkucmVtb3ZlQ2xhc3MoJ3JlZCBhY2NlbnQtMScpO1xyXG4gICAgICAgIG1vZGFsLmNsb3NlTW9kYWwoKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZGVsZXRlKCkge1xyXG4gICAgICAgIGxldCBtb2RhbCA9ICQoJyNtb2RhbC10YXNrLWRlbGV0ZScpO1xyXG4gICAgICAgIGxldCBpZCA9IG1vZGFsLmRhdGEoJ3RhcmdldC1pZCcpO1xyXG4gICAgICAgIGxldCB1cmwgPSAodGhpcy5nZXRBY3RpdmVQYWdlKCkpID8gYHRvZG8vJHtpZH0/cGFnZT0ke3RoaXMuZ2V0QWN0aXZlUGFnZSgpfWBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGB0b2RvLyR7aWR9YDtcclxuICAgICAgICBsZXQgcmVxdWVzdCA9ICQuYWpheCh7dXJsOiB1cmwsIHR5cGU6ICdkZWxldGUnLCBkYXRhOiB7X3Rva2VuOiAkKCcjX3Rva2VuJykudmFsKCl9fSk7XHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICByZXF1ZXN0LmRvbmUoZnVuY3Rpb24ocmVzKXtcclxuICAgICAgICAgICAgbW9kYWwuY2xvc2VNb2RhbCgpO1xyXG4gICAgICAgICAgICBzZWxmLnJlbmRlclRvZG8ocmVzKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZW5kZXJUb2RvKHJlcykge1xyXG4gICAgICAgIGxldCBsaXN0ID0gJCgnI3RvZG8tbGlzdCcpO1xyXG4gICAgICAgIGxldCBjb2xsZWN0aW9uID0gbGlzdC5maW5kKCdsaTplcSgwKScpLnByb3AoJ291dGVySFRNTCcpO1xyXG4gICAgICAgIGxpc3QuZW1wdHkoKTtcclxuXHJcbiAgICAgICAgaWYgKHJlcy5kYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpIGluIHJlcy5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uICs9IHRoaXMubGkocmVzLmRhdGFbaV0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsaXN0LmFwcGVuZChjb2xsZWN0aW9uKTtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJQYWdpbmF0aW9uKHJlcyk7XHJcbiAgICAgICAgICAgICQoJy50YXNrLWRlbGV0ZS1kaWFsb2cnKS5sZWFuTW9kYWwoe2Rpc21pc3NpYmxlOiBmYWxzZX0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxpc3QuYXBwZW5kKGNvbGxlY3Rpb24pO1xyXG4gICAgICAgICAgICBsaXN0LmFwcGVuZChgPGxpIGNsYXNzPVwiY29sbGVjdGlvbi1pdGVtIGdyZXkgbGlnaHRlbi00IGdyZXktdGV4dFwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBbIEFkZCBZb3VyIGZpcnN0IFRhc2sgXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2xpPmApO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZW5kZXJQYWdpbmF0aW9uKHJlcykge1xyXG4gICAgICAgIGxldCBwYWdpbmF0aW9uID0gJyc7XHJcblxyXG4gICAgICAgIGlmICggISAkKCcucGFnaW5hdGlvbicpLmxlbmd0aCAmJiByZXMuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NyZWF0ZSBwYWdpbmF0aW9uIHVsJyk7XHJcbiAgICAgICAgICAgICQoJyNwYWdpbmF0aW9uLWNvbnRhaW5lcicpLmFwcGVuZChgPHVsIGNsYXNzPVwicGFnaW5hdGlvblwiPjwvdWw+YClcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBjb250YWluZXIgPSAkKCcucGFnaW5hdGlvbicpO1xyXG5cclxuXHJcbiAgICAgICAgaWYgKHJlcy5kYXRhLmxlbmd0aCkge1xyXG5cclxuICAgICAgICAgICAgY29udGFpbmVyLmVtcHR5KCk7XHJcblxyXG4gICAgICAgICAgICBpZiAocmVzLmxhc3RfcGFnZSA+IDEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgdXJsID0gbG9jYXRpb24ucHJvdG9jb2wgKyBcIi8vXCIgKyBsb2NhdGlvbi5ob3N0O1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBwcmV2ID0gKHJlcy5wcmV2X3BhZ2VfdXJsID09PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgID8gYDxsaT48c3Bhbj4gPDwgPC9zcGFuPjwvbGk+YFxyXG4gICAgICAgICAgICAgICAgICAgIDogYDxsaT48YSBocmVmPVwiJHtyZXMucHJldl9wYWdlX3VybH1cIj4gPDwgPC9hPjwvbGk+YDtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbmV4dCA9IChyZXMubmV4dF9wYWdlX3VybCA9PT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICA/IGA8bGk+PHNwYW4+ID4+IDwvc3Bhbj48L2xpPmBcclxuICAgICAgICAgICAgICAgICAgICA6IGA8bGk+PGEgaHJlZj1cIiR7cmVzLm5leHRfcGFnZV91cmx9XCI+ID4+IDwvYT48L2xpPmA7XHJcblxyXG4gICAgICAgICAgICAgICAgcGFnaW5hdGlvbiArPSBwcmV2O1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHJlcy5sYXN0X3BhZ2U7IGkrKykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBsZXQgbGkgPSBgPGxpPjxhIGhyZWY9XCIke3VybH0/cGFnZT0ke2l9XCI+JHtpfTwvYT48L2xpPmA7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXMuY3VycmVudF9wYWdlID09IGkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGkgPSBgPGxpIGNsYXNzPVwiYWN0aXZlXCI+PHNwYW4gY2xhc3M9XCJhY3RpdmVcIj4ke2l9PC9zcGFuPjwvbGk+YDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb24gKz0gbGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcGFnaW5hdGlvbiArPSBuZXh0O1xyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZChwYWdpbmF0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBsaSAocmVzKSB7XHJcbiAgICAgICAgbGV0IHRva2VuID0gJCgnI190b2tlbicpLnZhbCgpO1xyXG5cclxuICAgICAgICByZXR1cm4gYDxsaSBpZD1cInRhc2tfJHtyZXMuaWR9XCIgY2xhc3M9XCJjb2xsZWN0aW9uLWl0ZW1cIj5cclxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPVwidmlld18ke3Jlcy5pZH1cIiBjbGFzcz1cInZpZXctbW9kZSByb3cgbTBcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRleHQtanVzdGlmeSBjb2wgczEyXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImJyZWFrLXdvcmRcIiBpZD1cInRhc2tfc3Bhbl8ke3Jlcy5pZH1cIj4ke3Jlcy50YXNrfTwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJyaWdodC1hbGlnbiBjb2wgczEyXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBocmVmPVwiI21vZGFsLXRhc2stZGVsZXRlXCIgY2xhc3M9XCJzZWNvbmRhcnktY29udGVudCB0YXNrLWRlbGV0ZS1kaWFsb2dcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZC10ZXh0IHRleHQtYWNjZW50LTJcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS10YXNrLWlkPVwiJHtyZXMuaWR9XCIgdGl0bGU9XCJEZWxldGUgVGFza1wiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnNcIj5kZWxldGU8L2k+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9XCJqYXZhc2NyaXB0OnZvaWQoMClcIiBjbGFzcz1cInNlY29uZGFyeS1jb250ZW50IHRhc2stZWRpdFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLXRhc2staWQ9XCIke3Jlcy5pZH1cIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cIm1hdGVyaWFsLWljb25zXCI+bW9kZV9lZGl0PC9pPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9hPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4gIFxyXG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9XCJlZGl0XyR7cmVzLmlkfVwiIGNsYXNzPVwiZWRpdC1tb2RlXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDxmb3JtIGlkPVwidGFza19mb3JtXyR7cmVzLmlkfVwiIGNsYXNzPVwiY29sIHMxMFwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBuYW1lPVwiX3Rva2VuXCIgdmFsdWU9XCIke3Rva2VufVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJvdyB2YWxpZ24td3JhcHBlclwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJpbnB1dC1maWVsZCBjb2wgczEwXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRleHRhcmVhIGlkPVwidGFza19pbnB1dF8ke3Jlcy5pZH1cIiBuYW1lPVwidGFza1wiIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz1cIm1hdGVyaWFsaXplLXRleHRhcmVhIHZhbGlkYXRlXCIgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtdGFzay1pZD1cIiR7cmVzLmlkfVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heGxlbmd0aD1cIjI1NVwiPjwvdGV4dGFyZWE+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbCBzMiB2YWxpZ25cIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj1cImphdmFzY3JpcHQ6dm9pZCgwKVwiIGNsYXNzPVwic2Vjb25kYXJ5LWNvbnRlbnQgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLWVkaXQtY2FuY2VsIHJlZC10ZXh0IHRleHQtYWNjZW50LTJcIiBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLXRhc2staWQ9XCIke3Jlcy5pZH1cIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnMgZm9udC0zNVwiPm5vdF9pbnRlcmVzdGVkPC9pPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBocmVmPVwiamF2YXNjcmlwdDp2b2lkKDApXCIgY2xhc3M9XCJzZWNvbmRhcnktY29udGVudCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2stdXBkYXRlXCIgZGF0YS10YXNrLWlkPVwiJHtyZXMuaWR9XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz1cIm1hdGVyaWFsLWljb25zIGZvbnQtMzVcIj5kb25lPC9pPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZm9ybT5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICA8L2xpPmA7XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBUb2RvOyIsIi8vJChcIi5idXR0b24tY29sbGFwc2VcIikuc2lkZU5hdigpO1xyXG5cclxudmFyIFRvZG8gPSByZXF1aXJlKCcuLi9jb21wb25lbnRzL1RvZG8nKTtcclxuXHJcbiQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcudGFzay1jcmVhdGUnLCBmdW5jdGlvbihlKXtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnNvbGUubG9nKCdjcmVhdGUnKTtcclxuICAgICQoJy50YXNrLWNyZWF0ZScpLmhpZGUoKTtcclxuICAgIFRvZG8uY3JlYXRlKCk7XHJcbn0pO1xyXG5cclxuJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy50YXNrLWNyZWF0ZS1jYW5jZWwnLCBmdW5jdGlvbihlKXtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnNvbGUubG9nKCd0YXNrLWNyZWF0ZS1jYW5jZWwnKTtcclxuICAgIFRvZG8uY3JlYXRlQ2FuY2VsKCk7XHJcbn0pO1xyXG5cclxuJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy50YXNrLXN0b3JlJywgZnVuY3Rpb24oZSl7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBjb25zb2xlLmxvZygnY3JlYXRlJyk7XHJcbiAgICBUb2RvLnN0b3JlKCk7XHJcbn0pO1xyXG5cclxuJChkb2N1bWVudCkub24oXCJrZXlwcmVzc1wiLCBcInRleHRhcmVhXCIsIGZ1bmN0aW9uKGUpIHtcclxuXHJcbiAgICBpZiAoZS5rZXlDb2RlID09IDEzKSB7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIGxldCBpZCA9ICQodGhpcykuZGF0YSgndGFzay1pZCcpO1xyXG5cclxuICAgICAgICBpZiAoJCgnI3Rhc2tfMCcpLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBUb2RvLnN0b3JlKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgVG9kby51cGRhdGUoaWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gMjcpIHtcclxuICAgICAgICBsZXQgaWQgPSAkKHRoaXMpLmRhdGEoJ3Rhc2staWQnKTtcclxuICAgICAgICBpZiAoaWQgPT0gMCkge1xyXG4gICAgICAgICAgICBUb2RvLmNyZWF0ZUNhbmNlbCgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIFRvZG8uZWRpdENhbmNlbChpZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSk7XHJcblxyXG4kKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnRhc2stZWRpdCcsIGZ1bmN0aW9uKGUpe1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgY29uc29sZS5sb2coJ2VkaXQnKTtcclxuICAgIGxldCBpZCA9ICQodGhpcykuZGF0YSgndGFzay1pZCcpO1xyXG4gICAgVG9kby5lZGl0KGlkKTtcclxufSk7XHJcblxyXG4kKGRvY3VtZW50KS5vbignY2xpY2snLCAnLnRhc2stZWRpdC1jYW5jZWwnLCBmdW5jdGlvbihlKXtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnNvbGUubG9nKCdlZGl0LWNhbmNlbCcpO1xyXG4gICAgbGV0IGlkID0gJCh0aGlzKS5kYXRhKCd0YXNrLWlkJyk7XHJcbiAgICBUb2RvLmVkaXRDYW5jZWwoaWQpO1xyXG59KTtcclxuXHJcbiQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcudGFzay11cGRhdGUnLCBmdW5jdGlvbihlKXtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnNvbGUubG9nKCd1cGRhdGUnKTtcclxuICAgIGxldCBpZCA9ICQodGhpcykuZGF0YSgndGFzay1pZCcpO1xyXG4gICAgVG9kby51cGRhdGUoaWQpO1xyXG59KTtcclxuXHJcbiQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcudGFzay1kZWxldGUtZGlhbG9nJywgZnVuY3Rpb24oZSl7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBjb25zb2xlLmxvZygnZGVsZXRlLWRpYWxvZycpO1xyXG4gICAgbGV0IGlkID0gJCh0aGlzKS5kYXRhKCd0YXNrLWlkJyk7XHJcbiAgICBUb2RvLmRlbGV0ZURpYWxvZyhpZCk7XHJcbn0pO1xyXG5cclxuJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy50YXNrLWRlbGV0ZS1jYW5jZWwnLCBmdW5jdGlvbihlKXtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIFRvZG8uZGVsZXRlQ2FuY2VsKCk7XHJcbn0pO1xyXG5cclxuJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy50YXNrLWRlbGV0ZScsIGZ1bmN0aW9uKGUpe1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgY29uc29sZS5sb2coJ2RlbGV0ZScpO1xyXG4gICAgVG9kby5kZWxldGUoKTtcclxufSk7XHJcblxyXG4kKCdtYWluJykub24oJ2NsaWNrJywgJy5wYWdpbmF0aW9uIGEnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgJCgnLnBhZ2luYXRpb24nKS5maW5kKCdsaScpLnJlbW92ZUNsYXNzKCdhY3RpdmUgZGlzYWJsZWQnKTtcclxuICAgICQodGhpcykucGFyZW50KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgVG9kby5hbGwoJCh0aGlzKS5hdHRyKCdocmVmJykuc3BsaXQoJ3BhZ2U9JylbMV0pO1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG59KTtcclxuXHJcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XHJcbiAgICBUb2RvLmFsbCgxKTtcclxufSk7Il19
